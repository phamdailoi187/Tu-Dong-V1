<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <title>Qu·∫£n L√Ω B·ªánh Vi·ªán</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="p-4 bg-light">

    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="text-primary">üè• Admin B·ªánh Vi·ªán Dashboard</h2>
            <button onclick="logout()" class="btn btn-danger">ƒêƒÉng Xu·∫•t</button>
        </div>

        <div class="row">
            <div class="col-md-4">
                <div class="card shadow-sm">
                    <div class="card-header bg-primary text-white">‚ûï T·∫°o Nh√¢n Vi√™n Y T·∫ø M·ªõi</div>
                    <div class="card-body">
                        <form id="createStaffForm">
                            <div class="mb-2">
                                <label>H·ªç v√† T√™n</label>
                                <input type="text" id="fullName" class="form-control" required>
                            </div>
                            <div class="mb-2">
                                <label>T√™n ƒëƒÉng nh·∫≠p</label>
                                <input type="text" id="nvUsername" class="form-control" required>
                            </div>
                            <div class="mb-3">
                                <label>M·∫≠t kh·∫©u</label>
                                <input type="password" id="nvPassword" class="form-control" required>
                            </div>
                            <button type="submit" class="btn btn-primary w-100">T·∫°o Ngay</button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="col-md-8">
                <div class="card shadow-sm">
                    <div class="card-header bg-success text-white">üë®‚Äç‚öïÔ∏è Danh S√°ch Nh√¢n Vi√™n Y T·∫ø (C·ªßa Vi·ªán M√¨nh)</div>
                    <div class="card-body">
                        <button onclick="loadStaffs()" class="btn btn-sm btn-outline-secondary mb-3">üîÑ L√†m m·ªõi danh
                            s√°ch</button>
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>H·ªç T√™n</th>
                                    <th>Username</th>
                                    <th>Tr·∫°ng th√°i</th>
                                    <th>H√†nh ƒë·ªông</th>
                                </tr>
                            </thead>
                            <tbody id="staffTable">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const token = localStorage.getItem('token');
        if (!token) window.location.href = '/index.html';

        // 1. H√†m t·∫°o nh√¢n vi√™n
        document.getElementById('createStaffForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const fullName = document.getElementById('fullName').value;
            const username = document.getElementById('nvUsername').value;
            const password = document.getElementById('nvPassword').value;

            try {
                const res = await fetch('/api/bv-admin/create-nvyt', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ fullName, username, password })
                });

                const data = await res.json();
                if (res.ok) {
                    alert('‚úÖ ' + data.message);
                    document.getElementById('createStaffForm').reset();
                    loadStaffs(); // T·∫£i l·∫°i b·∫£ng
                } else {
                    alert('‚ùå L·ªói: ' + data.message);
                }
            } catch (err) {
                alert('L·ªói k·∫øt n·ªëi server');
            }
        });

        // 2. H√†m t·∫£i danh s√°ch nh√¢n vi√™n
        async function loadStaffs() {
            try {
                const res = await fetch('/api/bv-admin/list-nvyt', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await res.json();

                const tbody = document.getElementById('staffTable');
                tbody.innerHTML = '';

                if (data.data) {
                    data.data.forEach(u => {
                        tbody.innerHTML += `
                        <tr>
                            <td>${u.id}</td>
                            <td>${u.fullName}</td>
                            <td><b>${u.username}</b></td>
                            <td>${u.isActive ? '<span class="badge bg-success">Active</span>' : '<span class="badge bg-secondary">Locked</span>'}</td>
                            <td><button class="btn btn-sm btn-danger">X√≥a</button></td>
                        </tr>
                    `;
                    });
                }
            } catch (err) {
                console.error(err);
            }
        }

        function logout() {
            localStorage.removeItem('token');
            window.location.href = '/index.html';
        }

        // Ch·∫°y khi v√†o trang
        loadStaffs();
    </script>

</body>

</html>