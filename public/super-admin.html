<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <title>Si√™u Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="p-4">

    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>üëë Si√™u Admin - Qu·∫£n L√Ω B·ªánh Vi·ªán</h2>
            <button onclick="logout()" class="btn btn-danger">ƒêƒÉng Xu·∫•t</button>
        </div>

        <div class="card">
            <div class="card-header bg-dark text-white">Danh s√°ch B·ªánh Vi·ªán (T·ª´ Database)</div>
            <div class="card-body">
                <button onclick="loadHospitals()" class="btn btn-success mb-3">üîÑ T·∫£i Danh S√°ch</button>
                <table class="table table-bordered table-hover">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>T√™n B·ªánh Vi·ªán</th>
                            <th>ƒê·ªãa ch·ªâ</th>
                            <th>Admin ƒê·∫°i Di·ªán</th>
                            <th>H√†nh ƒë·ªông</th>
                        </tr>
                    </thead>
                    <tbody id="hospitalTable">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const token = localStorage.getItem('token');
        if (!token) window.location.href = '/index.html';

        async function loadHospitals() {
            try {
                const res = await fetch('/api/super-admin/hospitals', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await res.json();

                if (!res.ok) {
                    if (res.status === 403) alert('B·∫°n kh√¥ng c√≥ quy·ªÅn xem!');
                    return;
                }

                const tbody = document.getElementById('hospitalTable');
                tbody.innerHTML = ''; // X√≥a c≈©

                data.data.forEach(hos => {
                    // L·∫•y t√™n admin ƒë·∫°i di·ªán n·∫øu c√≥
                    const adminName = (hos.Users && hos.Users.length > 0) ? hos.Users[0].username : 'Ch∆∞a c√≥';

                    const row = `
                    <tr>
                        <td>${hos.id}</td>
                        <td>${hos.name}</td>
                        <td>${hos.address}</td>
                        <td><span class="badge bg-info">${adminName}</span></td>
                        <td>
                            <button class="btn btn-sm btn-warning">Kh√≥a/M·ªü</button>
                        </td>
                    </tr>
                `;
                    tbody.innerHTML += row;
                });
            } catch (err) {
                console.error(err);
                alert('L·ªói t·∫£i d·ªØ li·ªáu');
            }
        }

        function logout() {
            localStorage.removeItem('token');
            window.location.href = '/index.html';
        }

        // T·ª± ƒë·ªông t·∫£i khi v√†o trang
        loadHospitals();
    </script>

</body>

</html>